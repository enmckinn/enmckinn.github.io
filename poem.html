<!DOCTYPE html>
<html lang="en">
<head>
    <title>Random Poem Generator</title>
    <style>
        body { font-family: sans-serif; }
        #output { white-space: pre-wrap; margin-top: 20px; border: 1px solid #ccc; padding: 10px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin-right: 10px; }
    </style>
</head>
<body>
    <h1>Random Poem Generator</h1>
    <button id="startButton">Start</button>
    <button id="stopButton">Stop</button>
    <div id="output"></div>

    <script>
        let intervalID;

       async function getNewsFromBackend() {
    try {
        const response = await fetch('/api/news');
        const data = await response.json();
        return data.articles.map(article => article.title.split(/\W+/)).flat();
    } catch (error) {
        console.error('Error fetching data:', error);
        return ["error", "fetching", "news"];
    }
}


        function getGinsbergPhrase(maxWords = 6) {
            const ginsbergPhrases = [
                "automobile graveyard dream", "empty lots and broken concrete",
                "gasoline trees in the wind", "iron cathedral of armies"
            ];
            return shuffleArray(ginsbergPhrases)[0].split(/\s+/).slice(0, maxWords);
        }

        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        async function generateText() {
    const headlineWords = await getNewsFromBackend();
    const ginsbergPhrase = getGinsbergPhrase();
    const lastLine = "BE COOL! Everything is going to work out well!";
    return `${headlineWords.slice(0, 4).join(' ')}\n${ginsbergPhrase.join(' ')}\n${lastLine}`;
}


        async function runGenerator() {
            const outputDiv = document.getElementById('output');
            outputDiv.textContent = await generateText();
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('startButton').addEventListener('click', () => {
                if (!intervalID) {
                    runGenerator(); // Run once immediately
                    intervalID = setInterval(runGenerator, 3000); // Update every 3s
                }
            });

            document.getElementById('stopButton').addEventListener('click', () => {
                clearInterval(intervalID);
                intervalID = null;
            });
        });
    </script>
</body>
</html>
